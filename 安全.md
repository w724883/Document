- xss

通过在页面拼接js代码，如

```html
<a href="/user/1"><script>alert(1)</script></a>

<img src="javascript:alert('XSS');" onerror="alert(1)">

<script>var user_data = {"exploit": "</script><script>alert(1);//"};</script>

<INPUT type="text" value='><SCRIPT>alert("XSS")</SCRIPT><xssa=''/>

<BODY onload="alert('XSS')">

<link rel="stylesheet" href="javascript：alert('XSS');">

<div style="width:expression(alert('XSS'));">
```

解决：

1.在合适的地方使用转义

2.不要相信来自用户的输入，过滤（不仅限于 POST Body，还包括 QueryString，甚至是 Headers）

- csrf

跨域伪造请求，使用户做出非本意的行为

1.通过代理发送请求

2.通过form表单提交请求

解决：

1.给所有请求加上 token 检查。token是随机字符串，只需确保其不可预测性即可。token 可以在 QueryString、POST body 甚至是 Custom Header 里，但千万不能在 Cookies 里。

检查 referer （请注意，这往往不能防御来自网站自身的 CSRF 攻击，如用户评论中的 <img> 就是一个常见触发点），ajax请求也能修改referer

- SQL 注入

通过在后端拼接sql代码，如

```sql
SELECT * FROM USERS WHERE UserName="";DROP TABLE USERS;--"
```

解决：

1.使用参数化查询，把所有变量作为参数，数据库不会将参数作为SQL指令处理

2.使用预编译

3.过滤变量中的指令

- 权限控制漏洞

后端代码不严谨，没有做校验


- 会话劫持

SESSION 与 COOKIE泄漏，导致其他用户得到与服务器的会话权限

- 中间人劫持（路由劫持、DNS劫持等）

1.路由劫持

链接免费wifi时，路由器提供一个特殊的dns服务，将所有的域名都解析到我们的电脑，并将wifi的dhcp-dns设置为电脑ip，其实就是抓包的原理。
我们可以拿到明文数据包，并且对数据包进行加工，比如插入脚本。

https 使用的是 443 端口进行数据传输，而浏览器的默认端口是 80. 劫持者首先劫持用户的 80 端口，当用户向目标页发起请求时，劫持者模拟正常的 https 请求向源服务器获取数据，然后通过 80 端口返回给用户。

强制客户端使用 HTTPS 访问页面。其原理就是：

启用HSTS，在服务器响应头中添加 Strict-Transport-Security，可以设置 max-age

用户访问时，服务器种下这个头

下次如果使用 http 访问，只要 max-age 未过期，客户端会进行内部跳转，可以看到 307 Redirect Internel 的响应码，变成 https 访问源服务器

HSTS存在的问题：

纯 IP 的请求，HSTS 没法处理，比如 http://2.2.2.2 ， 即便响应头中设置了 STS，浏览器也不会理会（未测试）

HSTS 只能在 80 和 443 端口之间切换，如果服务是 8080 端口，即便设置了 STS，也无效（未测试）

如果浏览器证书错误，一般情况会提醒存在安全风险，然是依然给一个链接进入目标页，而 HSTS 则没有目标页入口，所以一旦证书配置错误，就是很大的故障了

如果服务器的 HTTPS 没有配置好就开启了 STS 的响应头，并且还设置了很长的过期时间，那么在你服务器 HTTPS 配置好之前，用户都是没办法连接到你的服务器的，除非 max-age 过期了。

HSTS 能让你的网站在 ssllab 上到 A+（这不是坑）

2. DNS劫持

常见的DNS攻击包括：

　　1) 域名劫持

　　通过采用黑客手段控制了域名管理密码和域名管理邮箱，然后将该域名的NS纪录指向到黑客可以控制的DNS服务器，然后通过在该DNS服务器上添加相应域名纪录，从而使网民访问该域名时，进入了黑客所指向的内容。

　　这显然是DNS服务提供商的责任，用户束手无策。

　　2) 缓存投毒

　　利用控制DNS缓存服务器，把原本准备访问某网站的用户在不知不觉中带到黑客指向的其他网站上。其实现方式有多种，比如可以通过利用网民ISP端的DNS缓存服务器的漏洞进行攻击或控制，从而改变该ISP内的用户访问域名的响应结果;或者，黑客通过利用用户权威域名服务器上的漏洞，如当用户权威域名服务器同时可以被当作缓存服务器使用，黑客可以实现缓存投毒，将错误的域名纪录存入缓存中，从而使所有使用该缓存服务器的用户得到错误的DNS解析结果。

　　最近发现的DNS重大缺陷，就是这种方式的。只所以说是“重大”缺陷，据报道是因为是协议自身的设计实现问题造成的，几乎所有的DNS软件都存在这样的问题。

　　3)DDOS攻击

　　一种攻击针对DNS服务器软件本身，通常利用BIND软件程序中的漏洞，导致DNS服务器崩溃或拒绝服务;另一种攻击的目标不是DNS服务器，而是利用DNS服务器作为中间的“攻击放大器”，去攻击其它互联网上的主机，导致被攻击主机拒绝服务。

　　4) DNS欺骗

　　DNS欺骗就是攻击者冒充域名服务器的一种欺骗行为。

　　原理：如果可以冒充域名服务器，然后把查询的IP地址设为攻击者的IP地址，这样的话，用户上网就只能看到攻击者的主页，而不是用户想要取得的网站的主页了，这就是DNS欺骗的基本原理。DNS欺骗其实并不是真的“黑掉”了对方的网站，而是冒名顶替、招摇撞骗罢了。

　　现在的Internet上存在的DNS服务器有绝大多数都是用bind来架设的,使用的bind版本主要为bind 4.9.5+P1以前版本和bind 8.2.2-P5以前版本.这些bind有个共同的特点,就是BIND会缓存(Cache)所有已经查询过的结果,这个问题就引起了下面的几个问题的存在.

　　DNS欺骗

　　在DNS的缓存还没有过期之前,如果在DNS的缓存中已经存在的记录,一旦有客户查询,DNS服务器将会直接返回缓存中的记录
